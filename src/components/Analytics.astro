---
const GA_MEASUREMENT_ID = 'G-Z9HFYE12L4';
const isProd = import.meta.env.PROD;
---

{isProd && (
  <script is:inline define:vars={{ GA_MEASUREMENT_ID }}>
    // Defer GA loading until page is idle to reduce main-thread blocking
    const loadGA = () => {
      const script = document.createElement('script');
      script.src = `https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`;
      script.async = true;
      document.head.appendChild(script);

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      window.gtag = gtag;
      gtag('js', new Date());
      gtag('config', GA_MEASUREMENT_ID);
    };

    // Load after page is interactive
    if ('requestIdleCallback' in window) {
      requestIdleCallback(loadGA, { timeout: 3000 });
    } else {
      setTimeout(loadGA, 2000);
    }
  </script>
)}
