---
import { mainNavigation, socialLinks } from '@/config/navigation';
import TammLogo from '@/components/icons/TammLogo.astro';
import IconMenu from '@/components/icons/IconMenu.astro';
import SocialIcon from '@/components/SocialIcon.astro';

interface Props {
  isHomepage?: boolean;
}

const { isHomepage = false } = Astro.props;
---

<header class="border-b border-zinc-200 dark:border-zinc-800 sticky top-0 bg-white/95 dark:bg-zinc-900/95 backdrop-blur-sm z-50">
  <nav class="flex flex-wrap items-center justify-between gap-4 p-4 md:p-6 max-w-6xl mx-auto">
    {isHomepage ? (
      <a href="/" class="header-logo hover:opacity-80" data-hidden="true">
        <TammLogo class="h-10 md:h-12 w-auto" />
      </a>
    ) : (
      <a href="/" class="hover:opacity-80" transition:name="site-logo">
        <TammLogo class="h-10 md:h-12 w-auto" />
      </a>
    )}

    <!-- Mobile menu button -->
    <button
      id="mobile-menu-toggle"
      class="flex items-center gap-2 p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 md:hidden"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <span class="sr-only">Toggle menu</span>
      <IconMenu class="h-6 w-6" />
    </button>

    <!-- Desktop navigation -->
    <div class="hidden md:flex items-center gap-6">
      {mainNavigation.map((link) => (
        <a
          href={link.href}
          class="text-zinc-600 dark:text-zinc-400 hover:text-brand-orange"
          {...(link.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
        >
          {link.label}
        </a>
      ))}

      <div class="flex items-center gap-3 ml-4 pl-4 border-l border-zinc-200 dark:border-zinc-700">
        {socialLinks.slice(0, 4).map((link) => (
          <a
            href={link.href}
            target="_blank"
            rel="noopener noreferrer"
            class="text-zinc-500 hover:text-brand-orange "
            title={link.label}
          >
            <SocialIcon name={link.icon} class="h-5 w-5" />
          </a>
        ))}
      </div>
    </div>

    <!-- Mobile menu -->
    <div id="mobile-menu" class="hidden w-full md:hidden">
      <div class="flex flex-col gap-2 py-4 border-t border-zinc-200 dark:border-zinc-800 mt-4">
        {mainNavigation.map((link) => (
          <a
            href={link.href}
            class="block p-3 rounded-lg text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-brand-orange "
            {...(link.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
          >
            {link.label}
          </a>
        ))}
        <div class="flex gap-4 p-3 mt-2">
          {socialLinks.map((link) => (
            <a
              href={link.href}
              target="_blank"
              rel="noopener noreferrer"
              class="text-zinc-500 hover:text-brand-orange "
              title={link.label}
            >
              <SocialIcon name={link.icon} class="h-6 w-6" />
            </a>
          ))}
        </div>
      </div>
    </div>
  </nav>
</header>

<script is:inline>
  (function() {
    let scrollHandler = null;

    function initHeader() {
      // Mobile menu toggle
      const toggle = document.getElementById('mobile-menu-toggle');
      const menu = document.getElementById('mobile-menu');

      toggle?.addEventListener('click', () => {
        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', String(!isExpanded));
        menu?.classList.toggle('hidden');
      });

      // Homepage logo scroll animation
      const headerLogo = document.querySelector('.header-logo');
      const heroLogo = document.querySelector('.hero-logo');

      // Clean up previous scroll handler
      if (scrollHandler) {
        window.removeEventListener('scroll', scrollHandler);
        scrollHandler = null;
      }

      if (headerLogo && heroLogo) {
        let isHeaderVisible = false;

        scrollHandler = () => {
          const heroRect = heroLogo.getBoundingClientRect();
          const shouldShowHeader = heroRect.top < 80;

          if (shouldShowHeader !== isHeaderVisible) {
            isHeaderVisible = shouldShowHeader;

            if (shouldShowHeader) {
              // Show header logo, hide hero
              heroLogo.dataset.hidden = 'true';
              delete headerLogo.dataset.hidden;
              // Swap view-transition-name so header logo animates on page nav
              heroLogo.style.viewTransitionName = 'none';
              headerLogo.style.viewTransitionName = 'site-logo';
            } else {
              // Show hero logo, hide header
              delete heroLogo.dataset.hidden;
              headerLogo.dataset.hidden = 'true';
              // Swap view-transition-name so hero logo animates on page nav
              headerLogo.style.viewTransitionName = 'none';
              heroLogo.style.viewTransitionName = 'site-logo';
            }
          }
        };

        window.addEventListener('scroll', scrollHandler, { passive: true });
        scrollHandler();
      }
    }

    initHeader();
    document.addEventListener('astro:page-load', initHeader);
  })();
</script>
