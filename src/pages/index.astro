---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import TammLogo from '@/components/icons/TammLogo.astro';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const latestPost = posts[0];
// Preload 800w as it covers most viewport sizes
const lcpImage = latestPost ? `/og/${latestPost.slug}-800w.webp` : undefined;
---

<BaseLayout title="Home" isHomepage={true} lcpImage={lcpImage}>
  <div class="max-w-4xl mx-auto px-6 py-12">
    <section class="mb-16">
      <p class="text-4xl md:text-5xl font-bold mb-6">
        Hej, jag Ã¤r
      </p>
      <div class="hero-logo mb-4" transition:name="site-logo">
        <TammLogo class="w-full h-auto" />
      </div>
      <p class="text-sm text-zinc-500 dark:text-zinc-400 mb-6">
        <span class="italic">(pronounced TAH-mm, rhymes with "calm")</span>
      </p>
      <p class="text-xl text-zinc-600 dark:text-zinc-400 leading-relaxed mb-4">
        Web Sorceress. Engineering Leader. Diversity in Tech Advocate.
      </p>
      <p class="text-lg text-zinc-600 dark:text-zinc-400 leading-relaxed">
        I'm Head of Technology at <a href="https://www.australiangeographic.com.au/" class="text-brand-orange underline decoration-brand-orange/30 hover:decoration-brand-orange">Australian Geographic</a>,
        previously at Canva. I write about tech, build communities like <a href="https://queerrunclub.au" class="text-brand-orange underline decoration-brand-orange/30 hover:decoration-brand-orange">Queer Run Club</a>,
        and pat every office dog on request.
      </p>
    </section>

    {latestPost && (
      <section class="mb-16">
        <h2 class="text-2xl font-semibold mb-6">Latest Post</h2>
        <a href={`/blog/${latestPost.slug}`} class="group block">
          <article class="border-b border-zinc-200 dark:border-zinc-800 pb-8">
            <picture>
              <source
                type="image/webp"
                srcset={`/og/${latestPost.slug}-400w.webp 400w, /og/${latestPost.slug}-800w.webp 800w, /og/${latestPost.slug}.webp 1200w`}
                sizes="(max-width: 640px) 400px, (max-width: 1024px) 800px, 1200px"
              />
              <img
                src={latestPost.data.ogImage || `/og/${latestPost.slug}.png`}
                alt={latestPost.data.title}
                class="w-full rounded-lg mb-4"
                width="1200"
                height="630"
                fetchpriority="high"
                decoding="async"
              />
            </picture>
            <h3 class="text-xl font-semibold text-brand-orange group-hover:underline mb-2">
              {latestPost.data.title}
            </h3>
            <time class="text-sm text-zinc-500 dark:text-zinc-400">
              {latestPost.data.pubDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
            </time>
            {latestPost.data.description && (
              <p class="mt-2 text-zinc-600 dark:text-zinc-400">
                {latestPost.data.description}
              </p>
            )}
            {latestPost.data.tags.length > 0 && (
              <div class="mt-3 flex flex-wrap gap-2">
                {latestPost.data.tags.map((tag) => (
                  <span class="text-xs px-2 py-1 bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 rounded">
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </article>
        </a>
        <a href="/blog" class="inline-block mt-6 text-brand-orange underline decoration-brand-orange/30 hover:decoration-brand-orange">
          View all posts &rarr;
        </a>
      </section>
    )}

    <section>
      <h2 class="text-2xl font-semibold mb-6">Projects</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <!-- Queer Run Club -->
        <a
          href="https://queerrunclub.au"
          target="_blank"
          rel="noopener noreferrer"
          class="group block border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 hover:border-brand-orange transition-colors"
        >
          <div class="flex flex-col items-center text-center gap-4">
            <picture>
                <source srcset="/qrc-logo.webp" type="image/webp" />
                <img src="/qrc-logo.svg" alt="Queer Run Club logo" class="h-28 w-auto flex-shrink-0" width="80" height="112" loading="lazy" decoding="async" />
              </picture>
            <div>
              <h3 class="text-xl font-semibold text-brand-orange group-hover:underline mb-2">
                Queer Run Club
              </h3>
              <p class="text-zinc-600 dark:text-zinc-400">
                A community running group creating safe spaces for LGBTQIA+ folks and allies. All paces welcome. Joy mandatory.
              </p>
            </div>
          </div>
        </a>

        <!-- Book -->
        <a
          href="/to/news"
          class="group block border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 hover:border-brand-orange transition-colors"
        >
          <div class="flex flex-col items-center text-center gap-4">
            <span class="text-7xl h-28 flex items-center justify-center">ðŸ“•</span>
            <div>
              <h3 class="text-xl font-semibold text-brand-orange group-hover:underline mb-2">
                I'm Writing a Book
              </h3>
              <p class="text-zinc-600 dark:text-zinc-400">
                Sign up for my newsletter to find out more and be the first to know when it's ready.
              </p>
            </div>
          </div>
        </a>
      </div>
    </section>
  </div>
</BaseLayout>
